# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: Postal –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∞–ª—å—à–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

## üî¥ –û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

**–í `config/postal.yml` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ù–ï –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã!**

Postal –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MariaDB —Å –ø–∞—Ä–æ–ª–µ–º –±—É–∫–≤–∞–ª—å–Ω–æ `${MARIADB_PASSWORD}`, —á—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π HTML)
- –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–Ω–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î)
- –í –ª–æ–≥–∞—Ö: `Access denied for user 'postal'@'%'`

---

## ‚úÖ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç (Windows PowerShell)

```powershell
cd C:\Projects\Postal
.\fix-postal-config.ps1
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å envsubst (Linux/Mac)

```bash
cd /home/user/Postal

# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å envsubst –µ—Å–ª–∏ –Ω–µ—Ç
sudo apt-get install -y gettext-base

# 2. –°–æ–∑–¥–∞—Ç—å backup
cp config/postal.yml config/postal.yml.backup

# 3. –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
source .env
envsubst < config/postal.yml.example > config/postal.yml

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
grep "password:" config/postal.yml | head -2
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –ù–ï ${MARIADB_PASSWORD}
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –†—É—á–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ `config/postal.yml`
2. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ `${MARIADB_PASSWORD}` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø–∞—Ä–æ–ª—å –∏–∑ `.env`
3. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ `${RABBITMQ_PASSWORD}` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø–∞—Ä–æ–ª—å –∏–∑ `.env`
4. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ `${SECRET_KEY_BASE}` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `.env`
5. –ù–∞–π–¥–∏—Ç–µ –≤—Å–µ `${DOMAIN}` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω

---

## üîß –ü–û–®–ê–ì–û–í–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env —Ñ–∞–π–ª

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –µ—Å—Ç—å
grep -E "MARIADB_PASSWORD|RABBITMQ_PASSWORD|SECRET_KEY_BASE|DOMAIN" .env

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å:
# MARIADB_PASSWORD=–∫–∞–∫–æ–π-—Ç–æ_–ø–∞—Ä–æ–ª—å
# RABBITMQ_PASSWORD=–∫–∞–∫–æ–π-—Ç–æ_–ø–∞—Ä–æ–ª—å
# SECRET_KEY_BASE=–∫–∞–∫–æ–π-—Ç–æ_–∫–ª—é—á
# DOMAIN=linenarrow.com
```

### –®–∞–≥ 2: –ü–æ–¥—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

**Windows:**
```powershell
.\fix-postal-config.ps1
```

**Linux/Mac:**
```bash
source .env
envsubst < config/postal.yml.example > config/postal.yml
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å
grep -E "\$\{" config/postal.yml

# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - –≤—Å—ë —Ö–æ—Ä–æ—à–æ!
# –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç ${...} - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã
```

### –®–∞–≥ 4: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Postal

```bash
docker compose restart postal

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 10 —Å–µ–∫—É–Ω–¥
sleep 10

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs postal --tail=50 | grep -i error
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker compose logs postal --tail=50 | grep -i "mysql\|database\|denied"

# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# - "Access denied for user 'postal'@'%'"
# - "Can't connect to MySQL server"
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Postal –≤ –±—Ä–∞—É–∑–µ—Ä–µ:**
   - `http://your-server-ip:5000` –∏–ª–∏
   - `https://your-domain/postal/`

2. **–í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–≤–∏–≥–∞—Ü–∏—é:**
   - –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
   - –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä—ã
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   docker compose logs postal --tail=20
   # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
   ```

---

## üß™ –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: postal.yml –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω?

```bash
cat config/postal.yml | grep -E "password:|secret_key:" | head -3

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (—Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):
# password: f3a2d9e8c1b4...
# password: a8b3c2d1e9f4...
# secret_key: d1e2f3a4b5c6...

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∑–∞–º–µ–Ω–µ–Ω—ã):
# password: ${MARIADB_PASSWORD}
# password: ${RABBITMQ_PASSWORD}
# secret_key: ${SECRET_KEY_BASE}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Postal –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î?

```bash
docker compose logs postal --tail=50 | grep -i "mysql\|database\|connection"

# –ò—â–∏—Ç–µ:
# - "Can't connect to MySQL server" ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –ë–î
# - "Access denied" ‚Üí –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ postal.yml
# - "Connected to database" ‚Üí –≤—Å—ë —Ö–æ—Ä–æ—à–æ
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞?

```bash
docker compose exec mariadb mysql -upostal -p${MARIADB_PASSWORD} postal -e "SHOW TABLES;" | head -20

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü—ã:
# - users
# - organizations
# - servers
# - domains
# - –∏ —Ç.–¥. (–º–Ω–æ–≥–æ —Ç–∞–±–ª–∏—Ü)

# –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:
docker compose exec postal postal initialize
```

---

## üìù –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò

### –û—à–∏–±–∫–∞: "Access denied for user 'postal'@'%'"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞—Ä–æ–ª—å –≤ postal.yml –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–∞—Ä–æ–ª–µ–º –≤ MariaDB

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ `.env`: `grep MARIADB_PASSWORD .env`
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å postal.yml —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Postal

### –û—à–∏–±–∫–∞: "Table 'postal.users' doesn't exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose exec postal postal initialize
docker compose exec postal postal make-user
```

### –û—à–∏–±–∫–∞: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** Postal –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å postal.yml (—Å–º. –≤—ã—à–µ)

---

**–ì–æ—Ç–æ–≤–æ!** –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è postal.yml Postal –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é. üéâ
