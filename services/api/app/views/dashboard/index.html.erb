<%= render 'stats', stats: @stats, period: @period %>

<h2 style="margin: 30px 0 20px 0;">Последние письма</h2>

<% if @recent_emails.present? %>
  <table>
    <thead>
      <tr>
        <th>Время</th>
        <th>Получатель</th>
        <th>Статус</th>
        <th>Кампания</th>
        <th>Открыто</th>
        <th>Клики</th>
      </tr>
    </thead>
    <tbody>
      <% @recent_emails.each do |email| %>
        <tr>
          <td><%= email.created_at.strftime('%Y-%m-%d %H:%M:%S') %></td>
          <td><%= email.recipient_masked %></td>
          <td>
            <span class="status-badge status-<%= email.status %>">
              <%= email.status %>
            </span>
          </td>
          <td><%= email.campaign_id %></td>
          <td>
            <%= email.tracking_events.select { |e| e.event_type == 'open' }.count %>
          </td>
          <td>
            <%= email.tracking_events.select { |e| e.event_type == 'click' }.count %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <div class="empty-state">
    <h3>Нет данных</h3>
    <p>Письма еще не отправлялись</p>
  </div>
<% end %>

