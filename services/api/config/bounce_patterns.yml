# Bounce Pattern Configuration
# Редактируйте этот файл через Dashboard → Mailing Rules → Bounce Patterns

version: '1.0'

# Категории, которые НЕ добавляются в bounce list
non_bounce_categories:
  - rate_limit
  - temporary
  - connection

# Категории, при которых останавливать рассылку (temporary/connection не останавливают — retry позже)
stop_mailing_categories:
  - rate_limit
  - spam_block
  - mailbox_full
  - connection

# Паттерны для определения типа ошибки
patterns:
  rate_limit:
    description: "Rate limiting errors from email providers"
    patterns:
      - 'rate limit'
      - 'too many connections'
      - 'receiving mail at a rate'
      - '429'
      - 'throttl'
      - 'connection rate limit'
      - 'too many messages'
      - '5.7.1.*rate.*limit'

  temporary:
    description: "Temporary delivery failures"
    patterns:
      - 'try again'
      - 'try again later'
      - 'temporarily'
      - '4.7.'
      - 'greylisted'
      - 'temporary failure'
      - 'try later'
      - '421 4.7.0'
      - '450 4.2.1'
      - '451 4.5.1'
      - 'insufficient system storage'

  spam_block:
    description: "Spam blocks and blacklist rejections"
    patterns:
      - 'spam'
      - 'blacklist'
      - 'blocked'
      - 'rejected'
      - 'dnsbl'
      - 'rbl'
      - 'spamhaus'
      - 'suspected spam'
      - '550 5.7.1'
      - 'message has been blocked'
      - 'likely spam'
      - 'policy restrictions'

  user_not_found:
    description: "User or mailbox not found errors"
    patterns:
      - 'user unknown'
      - 'mailbox not found'
      - 'does not exist'
      - '550 5.1.1'
      - 'no such user'
      - 'recipient not found'
      - 'invalid recipient'
      - 'unable to find recipient'

  mailbox_full:
    description: "Mailbox full or quota exceeded"
    patterns:
      - 'mailbox full'
      - 'quota exceeded'
      - 'over quota'
      - '552'
      - 'mailbox is full'
      - 'storage quota'
      - '550 5.2.1'
      - '552 5.2.2'
      - 'exceeded storage allocation'

  authentication:
    description: "SPF, DKIM, DMARC authentication failures"
    patterns:
      - 'authentication'
      - 'spf'
      - 'dkim'
      - 'dmarc'
      - 'authentication failed'
      - '550 5.7.23'
      - 'unauthenticated email is not accepted'
      - 'does not have authentication'
      - 'spf/dkim/dmarc failure'
      - 'tls required'

  connection:
    description: "Connection and network errors"
    patterns:
      - 'connection refused'
      - 'timeout'
      - 'unreachable'
      - 'connection error'
      - 'network error'
      - 'connection reset'
      - 'service not available'
      - 'closing transmission channel'
