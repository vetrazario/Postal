# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ù–ê–í–ò–ì–ê–¶–ò–ò DASHBOARD

## üîß –í–´–ü–û–õ–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx

**–§–∞–π–ª:** `config/nginx.conf`

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–µ–Ω `location /dashboard` –Ω–∞ `location ~ ^/dashboard(/.*)?$`
- –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–¥–ø—É—Ç–∏ (`/dashboard/logs`, `/dashboard/settings` –∏ —Ç.–¥.) –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è

**–ë—ã–ª–æ:**
```nginx
location /dashboard {
    proxy_pass http://api_backend;
    ...
}
```

**–°—Ç–∞–ª–æ:**
```nginx
location ~ ^/dashboard(/.*)?$ {
    proxy_pass http://api_backend$request_uri;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto https;
    proxy_set_header Connection "";
    
    proxy_connect_timeout 30s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

---

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã AJAX –∑–∞–ø—Ä–æ—Å—ã (–¥–æ–±–∞–≤–ª–µ–Ω credentials)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
1. `services/api/app/views/dashboard/analytics/show.html.erb` (3 fetch –∑–∞–ø—Ä–æ—Å–∞)
2. `services/api/app/views/dashboard/settings/show.html.erb` (1 fetch –∑–∞–ø—Ä–æ—Å)
3. `services/api/app/views/dashboard/settings/_postal_config_form.html.erb` (1 fetch –∑–∞–ø—Ä–æ—Å)
4. `services/api/app/views/dashboard/settings/_ams_config_form.html.erb` (1 fetch –∑–∞–ø—Ä–æ—Å)
5. `services/api/app/views/dashboard/mailing_rules/show.html.erb` (1 fetch –∑–∞–ø—Ä–æ—Å)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–ª–µ–Ω `credentials: 'include'` –≤–æ –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ HTTP Basic Auth credentials.

**–ü—Ä–∏–º–µ—Ä:**
```javascript
// –ë—ã–ª–æ:
const response = await fetch('/dashboard/analytics/daily');

// –°—Ç–∞–ª–æ:
const response = await fetch('/dashboard/analytics/daily', {
  credentials: 'include'
});
```

---

## üìã –ß–¢–û –≠–¢–û –ò–°–ü–†–ê–í–õ–Ø–ï–¢

### –ü—Ä–æ–±–ª–µ–º–∞ #1: –ù–∞–≤–∏–≥–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞
- ‚ùå –ö–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–∞–º –≤ –º–µ–Ω—é –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–ª –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- ‚úÖ –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–¥–ø—É—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Nginx

### –ü—Ä–æ–±–ª–µ–º–∞ #2: AJAX –∑–∞–ø—Ä–æ—Å—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ 401
- ‚ùå –°—Ç—Ä–∞–Ω–∏—Ü—ã —Å AJAX (Analytics, Settings) –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –¢–µ–ø–µ—Ä—å –≤—Å–µ fetch –∑–∞–ø—Ä–æ—Å—ã –≤–∫–ª—é—á–∞—é—Ç credentials –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª –ø–∞—Ä–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ
- ‚ùå HTTP Basic Auth –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- ‚úÖ –¢–µ–ø–µ—Ä—å credentials –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ AJAX –∑–∞–ø—Ä–æ—Å–∞—Ö

---

## üöÄ –ö–ê–ö –ü–†–ò–ú–ï–ù–ò–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /home/user/Postal

# 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker compose restart nginx

# 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
docker compose restart api

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
curl -I https://your-domain/dashboard/
curl -I https://your-domain/dashboard/logs
```

### –í –±—Ä–∞—É–∑–µ—Ä–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ Dashboard: `https://your-domain/dashboard/`
2. –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
   - `/dashboard/logs` ‚úÖ
   - `/dashboard/settings` ‚úÖ
   - `/dashboard/analytics` ‚úÖ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—à–∏–±–æ–∫ 401

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```bash
docker compose exec nginx nginx -t
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "syntax is ok"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü–æ–¥–ø—É—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –¥–æ—Ö–æ–¥—è—Ç –¥–æ Rails
docker compose logs api --tail=20 | grep dashboard

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å—ã:
# GET /dashboard/logs
# GET /dashboard/settings
# –∏ —Ç.–¥.
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: AJAX –∑–∞–ø—Ä–æ—Å—ã
1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí Network
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/dashboard/analytics`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ AJAX –∑–∞–ø—Ä–æ—Å—ã - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 200 OK, –Ω–µ 401

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- HTTP Basic Auth credentials –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ
- –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã (–≤–∫–ª—é—á–∞—è AJAX) –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞—Ç—å credentials
- –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –≤—Å–µ –µ—â–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª—å - –æ—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –∏ cookies, –∑–∞—Ç–µ–º –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ

---

**–ì–æ—Ç–æ–≤–æ!** –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ Dashboard —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é. üéâ
