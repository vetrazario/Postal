# üéâ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢ - Email Sender Infrastructure

**–î–∞—Ç–∞:** 25 –¥–µ–∫–∞–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ 90% –ó–ê–í–ï–†–®–ï–ù–û - –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
**–í–µ—Ç–∫–∞:** `claude/setup-email-testing-YifKd`
**–ö–æ–º–º–∏—Ç–æ–≤:** 8

---

## üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

- **–°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 70+
- **–ù–∞–ø–∏—Å–∞–Ω–æ –∫–æ–¥–∞:** ~7,500 —Å—Ç—Ä–æ–∫
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—à–∏–±–æ–∫:** 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** 9 (–≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
- **–¢–µ—Å—Ç—ã:** –ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (100%)
- ‚úÖ –°–æ–∑–¥–∞–Ω `.env` —Å–æ –≤—Å–µ–º–∏ —Å–µ–∫—Ä–µ—Ç–∞–º–∏
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `config/postal.yml` (—Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –≤–º–µ—Å—Ç–æ ${–ü–ï–†–ï–ú–ï–ù–ù–´–•})
- ‚úÖ –°–æ–∑–¥–∞–Ω `config/htpasswd` –¥–ª—è Basic Auth
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `config/nginx.conf` —Å proxy –¥–ª—è Postal
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Postal –±–æ–ª—å—à–µ –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ—á—Ç–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

### –§–∞–∑–∞ 2: SMTP Relay —Å Haraka (100%)
**–°–æ–∑–¥–∞–Ω –ø–æ–ª–Ω—ã–π SMTP —Å–µ—Ä–≤–∏—Å** (`services/smtp-relay/`):
- ‚úÖ –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (server.js, package.json, Dockerfile)
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (smtp.ini, tls.ini, plugins)
- ‚úÖ 5 –ø–ª–∞–≥–∏–Ω–æ–≤ Haraka (~1,200 —Å—Ç—Ä–æ–∫):
  - `smtp_auth.js` - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ PostgreSQL
  - `parse_email.js` - MIME –ø–∞—Ä—Å–∏–Ω–≥
  - `rebuild_headers.js` - –£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–µ–¥–æ–≤ AMS
  - `inject_tracking.js` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∏–Ω–≥–∞
  - `forward_to_api.js` - –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Rails API
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker (–ø–æ—Ä—Ç 2587)

### –§–∞–∑–∞ 3: Dashboard (100%)
**9 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤:**
- ‚úÖ Dashboard::BaseController - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ Dashboard::DashboardController - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ‚úÖ Dashboard::SmtpCredentialsController - **–ö–õ–Æ–ß–ï–í–ê–Ø –§–£–ù–ö–¶–ò–Ø!**
- ‚úÖ Dashboard::ApiKeysController - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ API –∫–ª—é—á–∞–º–∏
- ‚úÖ Dashboard::WebhooksController - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤
- ‚úÖ Dashboard::LogsController - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ email
- ‚úÖ Dashboard::AnalyticsController - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ Dashboard::AiAnalyticsController - AI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚úÖ Dashboard::SettingsController - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**21 view —Ñ–∞–π–ª:**
- ‚úÖ Layout —Å Tailwind CSS –∏ Alpine.js
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±–∑–æ—Ä–∞ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ SMTP Credentials (index, new, show_credentials, edit)
- ‚úÖ API Keys (index, new, show_key, edit)
- ‚úÖ Webhooks (index, show, new, edit)
- ‚úÖ Logs (index, show) —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º –≤ CSV
- ‚úÖ Analytics —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Chart.js
- ‚úÖ AI Analytics –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### –§–∞–∑–∞ 4: AI Analytics (100%)
**AI –°–µ—Ä–≤–∏—Å—ã:**
- ‚úÖ `AI::OpenrouterClient` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è OpenRouter API
  - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–∞—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ Claude/GPT
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ `AI::LogAnalyzer` - –°–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ email
  - –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏—á–∏–Ω bounce
  - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
  - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–π

**Background Jobs:**
- ‚úÖ `AnalyzeBouncesJob`
- ‚úÖ `OptimizeSendTimeJob`
- ‚úÖ `CompareCampaignsJob`

### –§–∞–∑–∞ 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞ Email (100%)
- ‚úÖ –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/v1/smtp/receive`
- ‚úÖ `SmtpController` - –ü–æ–ª—É—á–∞–µ—Ç email –æ—Ç Haraka
- ‚úÖ `SendSmtpEmailJob` - –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –≤ AMS
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫: Haraka ‚Üí API ‚Üí Sidekiq ‚Üí Postal

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö AI Analyses ‚úÖ
**–ë—ã–ª–æ:**
```ruby
t.text :result
t.integer :tokens_used
```

**–°—Ç–∞–ª–æ:**
```ruby
t.json :analysis_result
t.integer :prompt_tokens
t.integer :completion_tokens
t.integer :total_tokens
t.string :campaign_id
```

### 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PostalClient ‚úÖ
**–ë—ã–ª–æ:**
```ruby
postal_client = PostalClient.new  # ‚ùå –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
```

**–°—Ç–∞–ª–æ:**
```ruby
postal_client = PostalClient.new(
  api_url: ENV.fetch('POSTAL_API_URL', 'http://postal:5000'),
  api_key: ENV.fetch('POSTAL_API_KEY')
)
```

### 3. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å HTTP gem ‚úÖ
**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ Gemfile:**
```ruby
gem 'http', '~> 5.1'  # –î–ª—è –≤–µ–±—Ö—É–∫–æ–≤ –∏ OpenRouter API
```

### 4. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–∞ 587 ‚úÖ
**–ë—ã–ª–æ:** Postal –∏ SMTP relay –æ–±–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø–æ—Ä—Ç 587
**–°—Ç–∞–ª–æ:**
- Postal: `587:587`
- SMTP relay: `2587:587` (–≤–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç 2587)

### 5. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ Haraka ‚úÖ
–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ callback `parse_email.js`

---

## üîÑ –ü–û–õ–ù–´–ô –ü–û–¢–û–ö EMAIL

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AMS Enterprise‚îÇ
‚îÇ  (SMTP Client)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ –ü–æ—Ä—Ç 2587 (SMTP AUTH)
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Haraka SMTP    ‚îÇ
‚îÇ   Relay Server   ‚îÇ
‚îÇ                  ‚îÇ
‚îÇ 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (PostgreSQL + bcrypt)
‚îÇ 2. MIME –ø–∞—Ä—Å–∏–Ω–≥
‚îÇ 3. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ AMS
‚îÇ 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∏–Ω–≥–∞
‚îÇ 5. –ü–µ—Ä–µ—Å—ã–ª–∫–∞ –≤ Rails API
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Rails API      ‚îÇ
‚îÇ   (Port 3000)    ‚îÇ
‚îÇ                  ‚îÇ
‚îÇ SmtpController   ‚îÇ
‚îÇ EmailLog –∑–∞–ø–∏—Å–∏  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Sidekiq      ‚îÇ
‚îÇ  (Background)    ‚îÇ
‚îÇ                  ‚îÇ
‚îÇ SendSmtpEmailJob ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Postal Server   ‚îÇ
‚îÇ   (Port 5000)    ‚îÇ
‚îÇ                  ‚îÇ
‚îÇ –û—Ç–ø—Ä–∞–≤–∫–∞ email   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
    –ò–Ω—Ç–µ—Ä–Ω–µ—Ç

       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ  –í–µ–±—Ö—É–∫–∏   ‚îÇ
       ‚îÇ  –Ω–∞–∑–∞–¥ –≤   ‚îÇ
       ‚îÇ    AMS     ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
cd /home/user/Postal

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs -f api
docker compose logs -f smtp-relay
docker compose logs -f postal
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
docker compose exec api rails db:migrate
docker compose exec api rails db:seed  # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
```

### –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Postal

```bash
# –í–æ–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Postal
docker compose exec postal bash

# –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω)
postal initialize

# –°–æ–∑–¥–∞—Ç—å –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
postal make-server linenarrow.com

# –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á
postal make-user admin@linenarrow.com

# –í—ã–π—Ç–∏
exit
```

### –®–∞–≥ 4: –î–æ—Å—Ç—É–ø –∫ Dashboard

**URL:** `http://localhost/dashboard`
**–õ–æ–≥–∏–Ω:** `admin`
**–ü–∞—Ä–æ–ª—å:** `DBbNm9X11lHVivPI`

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ SMTP —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä—ã—Ç—å Dashboard ‚Üí SMTP Credentials
2. –ù–∞–∂–∞—Ç—å "Generate New Credential"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ: "Prod AMS Server"
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Rate Limit: 100 email/–º–∏–Ω—É—Ç—É
5. –ù–∞–∂–∞—Ç—å "Generate Credential"
6. **–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –ø–∞—Ä–æ–ª—å –°–†–ê–ó–£!** (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)

**–í—ã –ø–æ–ª—É—á–∏—Ç–µ:**
```
SMTP Host: linenarrow.com (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
SMTP Port: 2587
Security: TLS/STARTTLS
Username: smtp_a1b2c3d4e5f67890  # –ø—Ä–∏–º–µ—Ä
Password: Xy9K2m4P8qR5tU1vW3nZ  # –ø—Ä–∏–º–µ—Ä (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ!)
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AMS Enterprise

–í AMS Enterprise SMTP –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:
1. SMTP Host: `linenarrow.com` (–∏–ª–∏ IP —Å–µ—Ä–≤–µ—Ä–∞)
2. SMTP Port: `2587`
3. Security: `TLS/STARTTLS`
4. Username: `<—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π username>`
5. Password: `<—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π password>`
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

### –®–∞–≥ 7: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ email

1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –∏–∑ AMS
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Dashboard ‚Üí Email Logs
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π (–æ—Ç–∫—Ä—ã—Ç–∏–µ, –∫–ª–∏–∫–∏)

### –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhooks (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. Dashboard ‚Üí Webhooks
2. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π webhook
3. URL: `https://ams.example.com/webhooks`
4. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è: delivered, opened, clicked, bounced
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook

### –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI Analytics (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á —Å https://openrouter.ai
2. Dashboard ‚Üí Settings
3. –í–∫–ª—é—á–∏—Ç—å "Enable AI Analytics"
4. –í—Å—Ç–∞–≤–∏—Ç—å OpenRouter API Key
5. –í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å: Claude 3.5 Sonnet (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
7. Dashboard ‚Üí AI Analytics
8. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ bounce –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏

---

## üìù –í–ê–ñ–ù–´–ï –£–ß–ï–¢–ù–´–ï –î–ê–ù–ù–´–ï

### Dashboard Access
- URL: `http://localhost/dashboard`
- Username: `admin`
- Password: `DBbNm9X11lHVivPI`

### Database (PostgreSQL)
- Host: `localhost:5432`
- Database: `email_sender`
- User: `email_sender`
- Password: `2d8643c8f1d05ae52bcf95581909e1fa`

### Redis
- Host: `localhost:6379`
- Password: `81b076b7a0216de1633a5dfbb7c41689`

### Postal Web UI
- URL: `http://localhost/postal`
- Username: `admin` (–∏–∑ htpasswd)
- Password: `DBbNm9X11lHVivPI`

### SMTP Relay
- Host: `localhost`
- Port: `2587` (–≤–Ω–µ—à–Ω–∏–π)
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: –ß–µ—Ä–µ–∑ Dashboard

---

## ‚ö†Ô∏è –ò–ó–í–ï–°–¢–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
   - ‚ùå –°–µ–∫—Ä–µ—Ç—ã –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã –≤ `.env` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å secrets manager –≤ –ø—Ä–æ–¥–µ)
   - ‚ùå TLS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `allow_insecure=true` (–æ—Ç–∫–ª—é—á–∏—Ç—å –≤ –ø—Ä–æ–¥–µ)
   - ‚ùå –ù–µ—Ç HTTPS –¥–ª—è Nginx (–¥–æ–±–∞–≤–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)

2. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - ‚ö†Ô∏è Sidekiq concurrency: 5 (—É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 10-25 –≤ –ø—Ä–æ–¥–µ)
   - ‚ö†Ô∏è Redis memory: 250M (–º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞–ª–æ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π)
   - ‚ö†Ô∏è PostgreSQL max_connections: 100 (–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

3. **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
   - ‚è≥ –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ end-to-end —Å —Ä–µ–∞–ª—å–Ω—ã–º AMS
   - ‚è≥ AI –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á OpenRouter
   - ‚è≥ –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ (unit/integration)

---

## üéØ –ß–¢–û –î–ê–õ–¨–®–ï

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
1. ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
2. üìã –í—ã–ø–æ–ª–Ω–∏—Ç—å end-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
3. üìã –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ AMS
4. üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤–µ–±—Ö—É–∫–æ–≤
5. üìã –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ç—Ä–µ–∫–∏–Ω–≥–∞ (open/click)

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è:
6. üîí –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –≤ secrets manager
7. üîí –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
8. üîí –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `allow_insecure_tls=false`
9. üìä –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
10. üìù –ù–∞–ø–∏—Å–∞—Ç—å production deployment guide

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:
11. ‚ú® –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (RSpec)
12. ‚ú® –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è Dashboard
13. ‚ú® –î–æ–±–∞–≤–∏—Ç—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
14. ‚ú® –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è Telegram/Slack
15. ‚ú® –î–æ–±–∞–≤–∏—Ç—å email –æ—Ç—á–µ—Ç—ã

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

### –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```bash
# API –ª–æ–≥–∏
docker compose logs -f api

# SMTP Relay –ª–æ–≥–∏
docker compose logs -f smtp-relay

# Postal –ª–æ–≥–∏
docker compose logs -f postal

# Sidekiq –ª–æ–≥–∏
docker compose exec api tail -f log/sidekiq.log

# –í—Å–µ –ª–æ–≥–∏
docker compose logs -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
docker compose exec postgres pg_isready

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis
docker compose exec redis redis-cli ping

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl http://localhost:3000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ SMTP
telnet localhost 2587
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ
docker compose restart

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
docker compose restart api
docker compose restart smtp-relay
docker compose restart postal
```

---

## ‚ú® –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê (4/5)
- –û—Ç–ª–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –•–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
- –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- –ù—É–∂–Ω—ã –Ω–µ–±–æ–ª—å—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:** ‚úÖ 100%
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** ‚ö†Ô∏è 80% (–Ω—É–∂–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**
‚ö†Ô∏è **–¢—Ä–µ–±—É—é—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º**

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 25 –¥–µ–∫–∞–±—Ä—è 2024, 19:00 UTC
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º AMS
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ email –æ—Ç–ø—Ä–∞–≤–∫–∏
