# ===========================================
# EMAIL SENDER INFRASTRUCTURE
# Environment Variables
# ===========================================
# 
# Переименуйте этот файл в .env и заполните значения:
#   mv env.example.txt .env
#
# ВАЖНО: Никогда не коммитьте .env в git!
# ===========================================

# ===========================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ===========================================

# Домен сервера (без https://)
# Пример для production: linenarrow.com
DOMAIN=linenarrow.com

# Email для Let's Encrypt уведомлений
# Пример: admin@linenarrow.com
LETSENCRYPT_EMAIL=admin@linenarrow.com

# Окружение (production, development, test)
RAILS_ENV=production

# ===========================================
# БАЗЫ ДАННЫХ
# ===========================================

# PostgreSQL (для Rails API)
# Генерация: openssl rand -hex 16
POSTGRES_PASSWORD=CHANGE_ME_GENERATE_RANDOM

# MariaDB (для Postal)
# Генерация: openssl rand -hex 16
MARIADB_PASSWORD=CHANGE_ME_GENERATE_RANDOM

# RabbitMQ (для Postal)
# Генерация: openssl rand -hex 16
RABBITMQ_PASSWORD=CHANGE_ME_GENERATE_RANDOM

# ===========================================
# СЕКРЕТЫ ПРИЛОЖЕНИЯ
# ===========================================

# Rails secret key base
# Генерация: openssl rand -hex 32
SECRET_KEY_BASE=CHANGE_ME_GENERATE_64_HEX

# Ключ шифрования для PII данных
# Генерация: rails db:encryption:init
ENCRYPTION_PRIMARY_KEY=CHANGE_ME
ENCRYPTION_DETERMINISTIC_KEY=CHANGE_ME
ENCRYPTION_KEY_DERIVATION_SALT=CHANGE_ME

# ===========================================
# API КЛЮЧИ
# ===========================================

# API ключ для AMS Enterprise
# Генерация: openssl rand -hex 24
# ВАЖНО: Этот ключ показывается ОДИН раз при создании!
# Передайте его в AMS для настройки подключения
API_KEY=CHANGE_ME_GENERATE_48_HEX

# ===========================================
# POSTAL
# ===========================================

# Signing key для Postal API
# Генерация: openssl rand -hex 32
POSTAL_SIGNING_KEY=CHANGE_ME_GENERATE_64_HEX

# Публичный ключ для проверки подписи webhook от Postal (PEM формат)
# Получите публичный ключ из Postal и вставьте сюда (включая BEGIN/END строки)
# Пример:
# POSTAL_WEBHOOK_PUBLIC_KEY="-----BEGIN PUBLIC KEY-----
# MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA...
# -----END PUBLIC KEY-----"
POSTAL_WEBHOOK_PUBLIC_KEY=CHANGE_ME_GET_FROM_POSTAL

# ===========================================
# ИНТЕГРАЦИЯ С AMS
# ===========================================

# URL для отправки webhook'ов обратно в AMS
# Пример: https://ams.example.com/api/webhooks/send_server
AMS_CALLBACK_URL=https://ams.example.com/api/webhooks/send_server

# API ключ для аутентификации запросов в AMS (если требуется)
AMS_API_KEY=

# ===========================================
# НАСТРОЙКИ EMAIL
# ===========================================

# Разрешённые домены отправителя (через запятую)
# Письма можно отправлять только от адресов с этих доменов
# Пример для production: linenarrow.com
ALLOWED_SENDER_DOMAINS=linenarrow.com

# Дневной лимит отправки писем (0 = без лимита)
DAILY_LIMIT=50000

# ===========================================
# WEBHOOK БЕЗОПАСНОСТЬ
# ===========================================

# Секрет для подписи исходящих webhook'ов
# Генерация: openssl rand -hex 32
WEBHOOK_SECRET=CHANGE_ME_GENERATE_64_HEX

# ===========================================
# ЛОГИРОВАНИЕ И МОНИТОРИНГ
# ===========================================

# Уровень логирования (debug, info, warn, error)
LOG_LEVEL=info

# Sentry DSN для отслеживания ошибок (опционально)
SENTRY_DSN=

# ===========================================
# REDIS
# ===========================================

# URL Redis (обычно не нужно менять при использовании Docker)
REDIS_URL=redis://redis:6379/0

# ===========================================
# SIDEKIQ
# ===========================================

# Количество потоков Sidekiq
# Для серверов с ограниченной памятью (2GB RAM) рекомендуется: 5
SIDEKIQ_CONCURRENCY=5

# ===========================================
# DASHBOARD И SIDEKIQ WEB UI
# ===========================================

# Учетные данные для Dashboard (обязательно)
DASHBOARD_USERNAME=admin
DASHBOARD_PASSWORD=CHANGE_ME_GENERATE_STRONG_PASSWORD

# Учетные данные для Sidekiq Web UI (опционально - если не заданы, Sidekiq Web не будет доступен)
SIDEKIQ_WEB_USERNAME=admin
SIDEKIQ_WEB_PASSWORD=CHANGE_ME_GENERATE_STRONG_PASSWORD

# ===========================================
# CORS
# ===========================================

# Разрешенные домены для CORS (через запятую)
# В development/test: по умолчанию разрешены все (*), если не задано
# В production: обязательно задать явно, иначе CORS будет отключен
# Пример: https://ams.example.com,https://admin.example.com
CORS_ORIGINS=https://ams.example.com

# ===========================================
# ГЕНЕРАЦИЯ СЕКРЕТОВ
# ===========================================
# 
# Для генерации всех секретов выполните:
#
# echo "POSTGRES_PASSWORD=$(openssl rand -hex 16)"
# echo "MARIADB_PASSWORD=$(openssl rand -hex 16)"
# echo "RABBITMQ_PASSWORD=$(openssl rand -hex 16)"
# echo "SECRET_KEY_BASE=$(openssl rand -hex 32)"
# echo "API_KEY=$(openssl rand -hex 24)"
# echo "POSTAL_SIGNING_KEY=$(openssl rand -hex 32)"
# echo "WEBHOOK_SECRET=$(openssl rand -hex 32)"
#
# ===========================================

