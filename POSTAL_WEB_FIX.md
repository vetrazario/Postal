# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –í–ï–ë–ê-–ü–ê–ù–ï–õ–ò POSTAL

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü–†–û–ë–õ–ï–ú–ê 1: postal.yml —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚ùå

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
```yaml
password: ${MARIADB_PASSWORD}   # ‚Üê –ù–ï –ó–ê–ú–ï–ù–ï–ù–û!
password: ${RABBITMQ_PASSWORD}  # ‚Üê –ù–ï –ó–ê–ú–ï–ù–ï–ù–û!
secret_key: ${SECRET_KEY_BASE}  # ‚Üê –ù–ï –ó–ê–ú–ï–ù–ï–ù–û!
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
Postal –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ YAML —Ñ–∞–π–ª–µ. –û–Ω —á–∏—Ç–∞–µ—Ç —Ñ–∞–π–ª –∫–∞–∫ –µ—Å—Ç—å, –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MariaDB —Å –ø–∞—Ä–æ–ª–µ–º –±—É–∫–≤–∞–ª—å–Ω–æ `${MARIADB_PASSWORD}`, —á—Ç–æ –∫–æ–Ω–µ—á–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–°–∏–º–ø—Ç–æ–º—ã:**
- Postal –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ë–î
- –í –ª–æ–≥–∞—Ö: `Access denied for user 'postal'@'%'`

---

### –ü–†–û–ë–õ–ï–ú–ê 2: Nginx –ù–ï –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç Postal –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚ùå

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
–í `config/nginx.conf` –µ—Å—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è:
- `/api/` ‚Üí Rails API
- `/track/` ‚Üí Tracking service
- `/dashboard` ‚Üí Rails API
- `/` ‚Üí Rails API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ù–û –ù–ï–¢ –º–∞—Ä—à—Ä—É—Ç–∞ –¥–ª—è Postal!**

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
Postal —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000 –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–æ nginx –Ω–µ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ –Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å—ã. –î–æ—Å—Ç—É–ø –∫ Postal –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –ø–æ—Ä—Ç 5000, –Ω–æ –Ω–µ —á–µ—Ä–µ–∑ nginx.

**–°–∏–º–ø—Ç–æ–º—ã:**
- http://localhost:5000 —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)
- http://localhost/postal –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (—á–µ—Ä–µ–∑ nginx)
- 404 –∏–ª–∏ —Ä–æ—É—Ç–∏—Ç—Å—è –Ω–∞ Rails API –≤–º–µ—Å—Ç–æ Postal

---

### –ü–†–û–ë–õ–ï–ú–ê 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö Postal –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ ‚ùå

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:**
–í docker-compose.yml –Ω–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Postal. –ö–æ–º–∞–Ω–¥–∞ `postal initialize` –¥–æ–ª–∂–Ω–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—Ä—É—á–Ω—É—é.

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞:**
–ë–µ–∑ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
- –¢–∞–±–ª–∏—Ü—ã –≤ MariaDB –Ω–µ —Å–æ–∑–¥–∞–Ω—ã
- –ù–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- Postal –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω, –Ω–æ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- "Table doesn't exist" –≤ –ª–æ–≥–∞—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É

---

## ‚úÖ –ë–´–°–¢–†–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å postal.yml (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

```bash
cd /home/user/Postal

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env
source .env

# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ envsubst —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
sudo apt-get install -y gettext-base

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ postal.yml —Å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
envsubst < config/postal.yml.example > config/postal.yml

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏—Å—å
echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è MariaDB ==="
grep "password:" config/postal.yml | head -2

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –Ω–µ ${...}
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ: password: a3f9d2e1c4b8...
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: password: ${MARIADB_PASSWORD}
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç Postal –≤ nginx.conf

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/home/user/Postal/config/nginx.conf` –∏ –¥–æ–±–∞–≤—å—Ç–µ –ü–ï–†–ï–î –±–ª–æ–∫–æ–º `# Dashboard`:

```nginx
        # Postal Web Interface
        location /postal/ {
            proxy_pass http://postal_backend/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Connection "";

            proxy_connect_timeout 60s;
            proxy_send_timeout 120s;
            proxy_read_timeout 120s;
        }
```

–ò–õ–ò –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ–¥–¥–æ–º–µ–Ω –¥–ª—è Postal (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production):

```nginx
    # Postal on subdomain
    server {
        listen 80;
        server_name postal.linenarrow.com;

        location / {
            proxy_pass http://postal_backend;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_set_header Connection "";
        }
    }
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Postal —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker compose restart postal

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥
sleep 10

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
docker compose restart nginx

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose ps
```

### –®–∞–≥ 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Postal (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)

```bash
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
docker compose exec postal postal initialize

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "database already exists" - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ

# –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω–∞)
docker compose exec postal postal make-user

# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
# Email: admin@linenarrow.com
# First Name: Admin
# Last Name: User
# Password: –≤–∞—à_–±–µ–∑–æ–ø–∞—Å–Ω—ã–π_–ø–∞—Ä–æ–ª—å

# –ó–∞–ø–æ–º–Ω–∏—Ç–µ/—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞!
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Postal –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é
curl -I http://localhost:5000
# –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP/1.1 200 OK

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Postal –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ nginx
curl -I http://localhost/postal/
# –û–∂–∏–¥–∞–µ—Ç—Å—è: HTTP/1.1 200 OK

# –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –õ–æ–≥–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
docker compose logs postal --tail=50 | grep -i error
# –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
- **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø:** http://your-server-ip:5000
- **–ß–µ—Ä–µ–∑ nginx:** http://your-server-ip/postal/
- **–ß–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω:** http://postal.linenarrow.com (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏)

---

## üìã –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: postal.yml –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω?

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–º–µ–Ω–µ–Ω—ã
cat config/postal.yml | grep -E "password:|secret_key:"

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (—Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):
# password: f3a2d9e8c1b4...
# password: a8b3c2d1e9f4...
# secret_key: d1e2f3a4b5c6...

# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥ (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –∑–∞–º–µ–Ω–µ–Ω—ã):
# password: ${MARIADB_PASSWORD}
# password: ${RABBITMQ_PASSWORD}
# secret_key: ${SECRET_KEY_BASE}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Postal –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MariaDB?

```bash
# –í–æ–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Postal
docker compose exec postal bash

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MariaDB
mysql -h mariadb -u postal -p
# –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∏–∑ config/postal.yml

# –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è
# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "Access denied" - –ø–∞—Ä–æ–ª—å –≤ postal.yml –Ω–µ–≤–µ—Ä–Ω—ã–π

# –í—ã–π–¥–∏—Ç–µ
exit
exit
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞?

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã Postal –≤ MariaDB
docker compose exec mariadb mysql -upostal -p${MARIADB_PASSWORD} postal -e "SHOW TABLES;"

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–∞–±–ª–∏—Ü—ã:
# - users
# - organizations
# - servers
# - domains
# –∏ —Ç.–¥.

# –ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
docker compose exec postal postal initialize
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ï—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
docker compose exec mariadb mysql -upostal -p${MARIADB_PASSWORD} postal -e "SELECT email FROM users;"

# –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —Å–æ–∑–¥–∞–π—Ç–µ:
docker compose exec postal postal make-user
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 5: –õ–æ–≥–∏ Postal

```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
docker compose logs postal --tail=100

# –ò—â–∏—Ç–µ:
# - "Can't connect to MySQL server" ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –ë–î
# - "Access denied" ‚Üí –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –≤ postal.yml
# - "Table doesn't exist" ‚Üí –ë–î –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
# - "Puma starting" ‚Üí –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (—Ö–æ—Ä–æ—à–æ)
# - "Listening on tcp://0.0.0.0:5000" ‚Üí —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (–æ—Ç–ª–∏—á–Ω–æ)
```

---

## üîß –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (–µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å postal.yml

```bash
cd /home/user/Postal

# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω
test -f .env && echo "‚úÖ .env exists" || echo "‚ùå .env missing"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ .env
echo "MARIADB_PASSWORD from .env:"
grep MARIADB_PASSWORD .env

echo "SECRET_KEY_BASE from .env:"
grep SECRET_KEY_BASE .env

# 3. –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp config/postal.yml config/postal.yml.backup

# 4. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ
source .env
envsubst < config/postal.yml.example > config/postal.yml

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π ==="
grep "password:" config/postal.yml | head -3

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –†–ï–ê–õ–¨–ù–´–ï –∑–Ω–∞—á–µ–Ω–∏—è, –ù–ï ${...}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ Postal

```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ Postal!

# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Postal
docker compose stop postal

# 2. –£–¥–∞–ª–∏—Ç–µ volume —Å –¥–∞–Ω–Ω—ã–º–∏
docker volume rm email_postal_data

# 3. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ postal.yml (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç 1)

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Postal
docker compose up -d postal

# 5. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
sleep 30

# 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–Ω–æ–≤–æ
docker compose exec postal postal initialize
docker compose exec postal postal make-user

# 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É
curl http://localhost:5000
```

---

## üéØ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Postal

```bash
curl -I http://localhost:5000
```

–û–∂–∏–¥–∞–µ—Ç—Å—è:
```
HTTP/1.1 200 OK
Content-Type: text/html
```

### 2. –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ nginx

```bash
curl -I http://localhost/postal/
```

–û–∂–∏–¥–∞–µ—Ç—Å—è:
```
HTTP/1.1 200 OK
```

### 3. –í—Ö–æ–¥ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://your-server-ip:5000

–î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ Postal —Å –ø–æ–ª—è–º–∏:
- Email
- Password

–í–≤–µ–¥–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥–æ–π `postal make-user`.

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞:
1. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é (Organization)
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä (Mail Server)
3. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏ (DKIM, SPF, MX)

---

## üìù –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò

### –û—à–∏–±–∫–∞: "Can't connect to MySQL server on 'mariadb'"

**–ü—Ä–∏—á–∏–Ω–∞:** MariaDB –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –Ω–µ –≥–æ—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose ps mariadb
docker compose logs mariadb --tail=50
docker compose restart mariadb
sleep 30
docker compose restart postal
```

### –û—à–∏–±–∫–∞: "Access denied for user 'postal'@'%'"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–∞—Ä–æ–ª—å –≤ postal.yml –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø–∞—Ä–æ–ª–µ–º –≤ MariaDB

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ .env
echo $MARIADB_PASSWORD

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ postal.yml
grep "password:" config/postal.yml | head -1

# –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ postal.yml
source .env
envsubst < config/postal.yml.example > config/postal.yml
docker compose restart postal
```

### –û—à–∏–±–∫–∞: "Table 'postal.users' doesn't exist"

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
```bash
docker compose exec postal postal initialize
```

### –û—à–∏–±–∫–∞: nginx 404 –Ω–∞ /postal/

**–ü—Ä–∏—á–∏–Ω–∞:** –ú–∞—Ä—à—Ä—É—Ç –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ nginx.conf

**–†–µ—à–µ–Ω–∏–µ:** –°–º. –®–∞–≥ 2 –≤—ã—à–µ (–¥–æ–±–∞–≤–∏—Ç—å location /postal/)

---

## üöÄ –ü–û–°–õ–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É –≤–∞—Å –±—É–¥–µ—Ç:

‚úÖ Postal –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://your-ip:5000
‚úÖ Postal –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ nginx –Ω–∞ http://your-ip/postal/
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω
‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏ –ø–æ—á—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ DNS –∑–∞–ø–∏—Å–∏** –¥–ª—è –≤–∞—à–µ–≥–æ –¥–æ–º–µ–Ω–∞
2. **–ü–æ–ª—É—á–∏—Ç–µ DKIM –∫–ª—é—á:** `docker compose exec postal postal default-dkim-record`
3. **–°–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á** –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Postal
4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSL** —á–µ—Ä–µ–∑ Let's Encrypt
5. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ** Postal —Å –≤–∞—à–∏–º Rails API

---

**–£–¥–∞—á–∏!** üéâ
