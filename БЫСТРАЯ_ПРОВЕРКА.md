# üöÄ –ë—ã—Å—Ç—Ä–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Å–ª–µ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å. –ò–º –Ω—É–∂–Ω–æ –≤—Ä–µ–º—è —á—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∏ —Å—Ç–∞—Ç—å `healthy`.

## –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /opt/email-sender
./check-startup.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –ü–æ–¥–æ–∂–¥—ë—Ç 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API
- ‚úÖ –î–∞—Å—Ç –∏—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

## –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –ü—Ä–æ–≤–µ—Ä–∫–∞

### –®–∞–≥ 1: –ü–æ–¥–æ–∂–¥–∞—Ç—å 30-60 —Å–µ–∫—É–Ω–¥
```bash
sleep 30
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```bash
docker compose ps
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
email_api          Up (healthy)     ‚úÖ
email_sidekiq      Up (healthy)     ‚úÖ
```

–ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å `(health: starting)` - –ø–æ–¥–æ–∂–¥–∏—Ç–µ –µ—â—ë 30 —Å–µ–∫—É–Ω–¥.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
docker compose logs api --tail=50
```

**–ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
- ‚ùå `verify_authenticity_token has not been defined`
- ‚ùå `PG::DuplicateTable`
- ‚ùå –î—Ä—É–≥–∏—Ö –æ—à–∏–±–æ–∫

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å**:
- ‚úÖ `Puma starting in cluster mode`
- ‚úÖ `* Listening on http://0.0.0.0:3000`
- ‚úÖ `Use Ctrl-C to stop`

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥–µ–ª–∏
```bash
docker compose exec api rails runner "
puts 'EmailClick: ' + EmailClick.count.to_s
puts 'EmailOpen: ' + EmailOpen.count.to_s
puts '–†–∞–±–æ—Ç–∞–µ—Ç!'
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
```
EmailClick: 0
EmailOpen: 0
–†–∞–±–æ—Ç–∞–µ—Ç!
```

### –®–∞–≥ 5: –û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
```
https://linenarrow.com
```

–î–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Ñ–æ—Ä–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.

## üÜò –ï—Å–ª–∏ –î–∞—à–±–æ—Ä–¥ –í—Å—ë –ï—â—ë –ù–µ –†–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä unhealthy

```bash
# –ü–æ–ª–Ω—ã–µ –ª–æ–≥–∏
docker compose logs api --tail=200 > api-full.log
cat api-full.log

# –ù–∞–π—Ç–∏ –æ—à–∏–±–∫—É
grep -i "error\|exception\|failed" api-full.log
```

–ü–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ –≤—ã–≤–æ–¥ - —è –ø–æ–º–æ–≥—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è.

### –ü—Ä–æ–±–ª–µ–º–∞: Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å nginx –ª–æ–≥–∏
docker compose logs nginx --tail=50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3000
docker compose exec api netstat -tlnp | grep 3000
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "502 Bad Gateway"

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É.

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω
docker compose ps api

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
docker compose exec nginx nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å nginx
docker compose restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "Connection refused"

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ nginx –∑–∞–ø—É—â–µ–Ω
docker compose ps nginx

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
sudo netstat -tlnp | grep -E ":(80|443)"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# tcp6  0  0 :::80   :::*  LISTEN  123/docker-proxy
# tcp6  0  0 :::443  :::*  LISTEN  456/docker-proxy
```

## ‚úÖ –ö–æ–≥–¥–∞ –í—Å—ë –†–∞–±–æ—Ç–∞–µ—Ç

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

1. ‚úÖ `docker compose ps` - –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `healthy`
2. ‚úÖ `docker compose logs api` - –Ω–µ—Ç –æ—à–∏–±–æ–∫
3. ‚úÖ –ú–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
4. ‚úÖ –î–∞—à–±–æ—Ä–¥ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
5. ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å email –∫–∞–º–ø–∞–Ω–∏–∏
6. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

## üìã –ö—Ä–∞—Ç–∫–∞—è –®–ø–∞—Ä–≥–∞–ª–∫–∞

```bash
# –í—Å—ë –≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ
cd /opt/email-sender && sleep 30 && docker compose ps && docker compose logs api --tail=30
```

–ï—Å–ª–∏ –≤—Å—ë `healthy` –∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö - **—Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ

---

**–ù–∞—á–Ω–∏—Ç–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏**: `./check-startup.sh`

–ï—Å–ª–∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –¥–∞—à–±–æ—Ä–¥ –≤—Å—ë –µ—â—ë –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø–æ–∫–∞–∂–∏—Ç–µ –º–Ω–µ –≤—ã–≤–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞, —è –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É.
